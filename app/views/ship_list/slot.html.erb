<div class="page-header">
  <h2><%= title %></h2>
</div>

<% if @statuses.blank? %>
    <div class="row">
      <div class="col-sm-12">
        <div class="panel panel-info">
          <div class="panel-heading">
            <h3 class="panel-title">このページについて</h3>
          </div>
          <div class="panel-body">
            <%= link_to '「インポート」', import_url %> ページで種別「艦娘一覧」の JSON ファイルをアップロードすると、この表に装備スロットの情報が表示されます。
          </div>
        </div>
      </div>
    </div>
<% end %>

<div class="container" style="margin-top: 10px;">
  <a id="button-all" class="btn btn-default">
    全表示
  </a>
  <a id="button-normal-only" class="btn btn-default">
    ノーマルのみ表示
  </a>
  <a id="button-kai-only" class="btn btn-default">
    改のみ表示
  </a>
</div>

<div class="container">
  <div class="table-responsive">
    <table id="table-ship-book" class="table table-striped table-bordered" cellspacing="0" width="100%">
      <thead>
      <tr>
        <th class="text-left col-xl-1 col-lg-1 col-md-1 col-ms-1 col-xs-1">図鑑 No.</th>
        <th class="text-left col-xl-1 col-lg-1 col-md-1 col-sm-1 hidden-xs">艦種</th>
        <th class="text-left col-xl-1 col-lg-1 col-md-1 col-sm-1 col-xs-1">艦名</th>
        <th class="text-left col-xl-1 col-lg-1 col-md-1 col-sm-1 col-xs-1">改</th>
        <th class="hidden">改（ソート用）</th>
        <th class="text-left col-xl-2 col-lg-2 col-md-2 col-sm-2 col-xs-2">スロット1</th>
        <th class="text-left col-xl-2 col-lg-2 col-md-2 col-sm-2 col-xs-2">スロット2</th>
        <th class="text-left col-xl-2 col-lg-2 col-md-2 col-ms-2 col-xs-2">スロット3</th>
        <th class="text-left col-xl-2 col-lg-2 col-md-2 col-ms-2 col-xs-2">スロット4</th>
      </tr>
      </thead>
      <tfoot>
      <tr>
        <th class="text-left">図鑑 No.</th>
        <th class="text-left hidden-xs">艦種</th>
        <th class="text-left">艦名</th>
        <th class="text-left col-xl-1 col-lg-1 col-md-1 col-sm-1 col-xs-1">改</th>
        <th class="hidden">改（ソート用）</th>
        <th class="text-left col-xl-2 col-lg-2 col-md-2 col-sm-2 col-xs-2">スロット1</th>
        <th class="text-left col-xl-2 col-lg-2 col-md-2 col-sm-2 col-xs-2">スロット2</th>
        <th class="text-left col-xl-2 col-lg-2 col-md-2 col-ms-2 col-xs-2">スロット3</th>
        <th class="text-left col-xl-2 col-lg-2 col-md-2 col-ms-2 col-xs-2">スロット4</th>
      </tr>
      </tfoot>
      <tbody>
      <% @statuses.each do |status| %>
          <% ship = @ships[status.book_no] %>
          <tr>
            <td class="numeric"><%= ship.book_no %></td>
            <td class="text-left hidden-xs"><%= ship.ship_type_by_status(status) %></td>
            <td class="text-left"><%= ship.ship_name %></td>
            <td class="text-left">
              <% if status.remodel_level == 1 %>
                  改
              <% else %>
                  <span class="hidden">N</span>
              <% end %>
            </td>
            <td class="hidden"><%= status.remodel_level %></td>
            <% 4.times.each do |idx| %>
                <% slot = status.ship_slot_statuses[idx] %>
                <% if slot and slot.slot_index == idx %>
                    <td class="text-left">
                      <%= slot.slot_equip_name %>
                      <% if slot.is_not_equipped_aircraft? %>
                          <span class="not-equipped">(<%= slot.slot_amount %>)</span>
                      <% elsif slot.is_equipped_aircraft? %>
                          (<%= slot.slot_amount %>)
                      <% end %>
                    </td>
                <% else %>
                    <td class="none"><i class="glyphicon glyphicon-minus"></i></td>
                <% end %>
            <% end %>
          </tr>
      <% end %>
      </tbody>
    </table>
  </div>
</div>

<script type="application/javascript">
  $(document).ready(function() {
    var table = $('#table-ship-book').DataTable($.extend({}, ADMIRAL_STATS_DATATABLES_DEFAULT, {
      "aoColumnDefs": [
        <!-- remodel_level で数値通りにソートするための設定 -->
        { "iDataSort": 4, "aTargets": [ 3 ] },
      ],
    }));

    $('#button-all').on('click', function (e) {
      e.preventDefault();
      <!-- 検索条件をリセット -->
      table.columns(3).search('').draw();
    });

    $('#button-normal-only').on('click', function (e) {
      e.preventDefault();
      table.columns(3).search('N').draw();
    });

    $('#button-kai-only').on('click', function (e) {
      e.preventDefault();
      table.columns(3).search('改').draw();
    });
  });
</script>
